"use strict";(self.webpackChunkmeshtastic_admin_frontend=self.webpackChunkmeshtastic_admin_frontend||[]).push([[282],{6282:(e,s,t)=>{t.r(s),t.d(s,{default:()=>h});var r=t(2555),a=t(5043),n=t(3230),i=t(5592),c=t(579);const o=e=>{var s;let{group:t,groups:r,users:a,onEdit:n,onDelete:i,onAddUser:d,onRemoveUser:l,level:x=0,isOrphaned:m=!1}=e;const h=r.filter(e=>e.parent_group_id===t.id),u=a.filter(e=>t.users&&t.users.some(s=>s.id===e.id));return(0,c.jsxs)("div",{className:"".concat(x>0?"ml-6 border-l border-dark-600 pl-4":""),children:[(0,c.jsxs)("div",{className:"flex items-start justify-between p-3 bg-dark-800/30 rounded",children:[(0,c.jsxs)("div",{className:"flex-1",children:[(0,c.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,c.jsx)("h4",{className:"font-semibold text-white",children:t.name}),m&&(0,c.jsx)("span",{className:"px-2 py-1 bg-yellow-600/20 text-yellow-400 text-xs rounded",children:"Orphaned"}),(0,c.jsxs)("span",{className:"text-xs text-gray-400",children:["(",u.length," users)"]})]}),t.description&&(0,c.jsx)("p",{className:"text-sm text-gray-300 mt-1",children:t.description}),(0,c.jsxs)("div",{className:"flex items-center space-x-4 mt-2 text-xs text-gray-400",children:[(0,c.jsxs)("span",{children:["Created: ",new Date(t.created_at).toLocaleDateString()]}),t.parent_group_id&&(0,c.jsxs)("span",{children:["Parent: ",(null===(s=r.find(e=>e.id===t.parent_group_id))||void 0===s?void 0:s.name)||"Unknown"]})]})]}),(0,c.jsxs)("div",{className:"flex space-x-2",children:[(0,c.jsx)("button",{onClick:()=>n(t),className:"text-accent-cyan hover:text-accent-cyan/80 text-sm",children:"Edit"}),(0,c.jsx)("button",{onClick:()=>i(t.id),className:"text-red-400 hover:text-red-300 text-sm",children:"Delete"})]})]}),h.map(e=>(0,c.jsx)(o,{group:e,groups:r,users:a,onEdit:n,onDelete:i,onAddUser:d,onRemoveUser:l,level:x+1},e.id))]})},d=()=>(0,c.jsx)("svg",{className:"w-6 h-6 text-accent-cyan",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,c.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})}),l=()=>(0,c.jsx)("svg",{className:"w-6 h-6 text-accent-cyan",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,c.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),x=()=>(0,c.jsx)("svg",{className:"w-6 h-6 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,c.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4"})}),m=()=>(0,c.jsxs)("svg",{className:"w-6 h-6 text-accent-cyan",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,c.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2H5a2 2 0 00-2 2z"}),(0,c.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 5a2 2 0 012-2h4a2 2 0 012 2v2H8V5z"}),(0,c.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 13l-3-3m0 0l-3 3m3-3v6"})]}),h=()=>{const[e,s]=(0,a.useState)([]),[t,h]=(0,a.useState)([]),[u,p]=(0,a.useState)(null),[j,g]=(0,a.useState)("groups"),[y,v]=(0,a.useState)(!1),[f,b]=(0,a.useState)(!1),[N,k]=(0,a.useState)(!0),[w,C]=(0,a.useState)({name:"",description:"",parent_group_id:""});(0,a.useEffect)(()=>{_(),A()},[]);const _=async()=>{try{const e=await fetch("/api/users/groups"),t=await e.json();s(t.groups||[])}catch(e){console.error("Error fetching groups:",e)}finally{k(!1)}},A=async()=>{try{const e=await fetch("/api/users/"),s=await e.json();h(s.users||[])}catch(e){console.error("Error fetching users:",e)}},E=async e=>{try{(await fetch("/api/users/groups/".concat(e),{method:"DELETE"})).ok&&_()}catch(s){console.error("Error deleting group:",s)}},S=async(e,s)=>{try{(await fetch("/api/users/groups/".concat(s,"/users/").concat(e),{method:"POST"})).ok&&_()}catch(t){console.error("Error adding user to group:",t)}},G=async(e,s)=>{try{(await fetch("/api/users/groups/".concat(s,"/users/").concat(e),{method:"DELETE"})).ok&&_()}catch(t){console.error("Error removing user from group:",t)}},D=e=>{p(e),C({name:e.name,description:e.description||""}),b(!0)};return N?(0,c.jsx)("div",{className:"flex items-center justify-center min-h-96",children:(0,c.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-accent-cyan"})}):(0,c.jsxs)("div",{className:"space-y-6",children:[(0,c.jsx)("div",{className:"flex space-x-1 bg-dark-800/50 p-1 rounded-lg",children:[{id:"groups",label:"Groups"},{id:"hierarchy",label:"Hierarchy"}].map(e=>(0,c.jsx)("button",{onClick:()=>g(e.id),className:"flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors ".concat(j===e.id?"bg-accent-cyan text-dark-900":"text-gray-300 hover:text-white"),children:e.label},e.id))}),(0,c.jsxs)("div",{className:"flex justify-between items-center",children:[(0,c.jsx)("h2",{className:"text-xl font-bold text-white",children:"hierarchy"===j?"Group Hierarchy":"User Groups"}),(0,c.jsxs)(i.A,{onClick:()=>v(!0),variant:"primary",className:"flex items-center space-x-2",children:[(0,c.jsx)("span",{children:"+"}),(0,c.jsx)("span",{children:"Create Group"})]})]}),(0,c.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,c.jsx)(n.A,{title:"Groups",icon:(0,c.jsx)(d,{}),children:(0,c.jsxs)("div",{className:"space-y-3",children:[e.map(e=>(0,c.jsx)("div",{className:"p-4 bg-dark-800/50 rounded-lg border border-dark-600 hover:border-accent-cyan/50 transition-colors cursor-pointer",onClick:()=>p(e),children:(0,c.jsxs)("div",{className:"flex justify-between items-start",children:[(0,c.jsxs)("div",{children:[(0,c.jsx)("h3",{className:"font-semibold text-white",children:e.name}),(0,c.jsx)("p",{className:"text-sm text-gray-300 mt-1",children:e.description}),(0,c.jsxs)("p",{className:"text-xs text-gray-400 mt-2",children:["Created: ",new Date(e.created_at).toLocaleDateString()]})]}),(0,c.jsxs)("div",{className:"flex space-x-2",children:[(0,c.jsx)("button",{onClick:s=>{s.stopPropagation(),D(e)},className:"text-accent-cyan hover:text-accent-cyan/80 text-sm",children:"Edit"}),(0,c.jsx)("button",{onClick:s=>{s.stopPropagation(),E(e.id)},className:"text-red-400 hover:text-red-300 text-sm",children:"Delete"})]})]})},e.id)),0===e.length&&(0,c.jsx)("p",{className:"text-gray-400 text-center py-8",children:"No groups created yet"})]})}),(0,c.jsx)(n.A,{title:u?u.name:"Select a Group",icon:u?(0,c.jsx)(l,{}):(0,c.jsx)(x,{}),children:u?(0,c.jsxs)("div",{className:"space-y-4",children:[(0,c.jsxs)("div",{children:[(0,c.jsx)("h4",{className:"font-semibold text-white mb-2",children:"Group Information"}),(0,c.jsx)("p",{className:"text-gray-300",children:u.description})]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("h4",{className:"font-semibold text-white mb-2",children:"Users in Group"}),(0,c.jsx)("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:u.users&&u.users.length>0?u.users.map(e=>(0,c.jsxs)("div",{className:"flex justify-between items-center p-2 bg-dark-800/30 rounded",children:[(0,c.jsxs)("div",{children:[(0,c.jsx)("span",{className:"text-white",children:e.long_name||e.short_name}),(0,c.jsxs)("span",{className:"text-gray-400 text-sm ml-2",children:["(",e.id,")"]})]}),(0,c.jsx)("button",{onClick:()=>G(e.id,u.id),className:"text-red-400 hover:text-red-300 text-sm",children:"Remove"})]},e.id)):(0,c.jsx)("p",{className:"text-gray-400 text-sm",children:"No users in this group"})})]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("h4",{className:"font-semibold text-white mb-2",children:"Add Users"}),(0,c.jsx)("div",{className:"space-y-2 max-h-32 overflow-y-auto",children:t.filter(e=>!u.users||!u.users.some(s=>s.id===e.id)).map(e=>(0,c.jsxs)("div",{className:"flex justify-between items-center p-2 bg-dark-800/30 rounded",children:[(0,c.jsx)("span",{className:"text-gray-300",children:e.long_name||e.short_name}),(0,c.jsx)("button",{onClick:()=>S(e.id,u.id),className:"text-green-400 hover:text-green-300 text-sm",children:"Add"})]},e.id))})]})]}):(0,c.jsx)("p",{className:"text-gray-400 text-center py-8",children:"Select a group to view details and manage users"})})]}),"hierarchy"===j&&(0,c.jsx)(n.A,{title:"Group Hierarchy",icon:(0,c.jsx)(m,{}),children:(0,c.jsx)("div",{className:"space-y-4",children:e.length>0?(0,c.jsxs)("div",{className:"space-y-4",children:[e.filter(e=>!e.parent_group_id).map(s=>(0,c.jsx)("div",{className:"border border-dark-600 rounded-lg p-4",children:(0,c.jsx)(o,{group:s,groups:e,users:t,onEdit:D,onDelete:E,onAddUser:S,onRemoveUser:G,level:0})},s.id)),e.filter(s=>s.parent_group_id&&!e.find(e=>e.id===s.parent_group_id)).map(s=>(0,c.jsx)("div",{className:"border border-yellow-600/30 rounded-lg p-4 bg-yellow-900/10",children:(0,c.jsx)(o,{group:s,groups:e,users:t,onEdit:D,onDelete:E,onAddUser:S,onRemoveUser:G,level:0,isOrphaned:!0})},s.id))]}):(0,c.jsx)("p",{className:"text-gray-400 text-center py-8",children:"No groups created yet"})})}),y&&(0,c.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:(0,c.jsx)(n.A,{className:"w-full max-w-md mx-4",children:(0,c.jsxs)("form",{onSubmit:async e=>{e.preventDefault();try{(await fetch("/api/users/groups",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(w)})).ok&&(v(!1),C({name:"",description:""}),_())}catch(s){console.error("Error creating group:",s)}},children:[(0,c.jsx)("h2",{className:"text-xl font-bold text-white mb-4",children:"Create New Group"}),(0,c.jsxs)("div",{className:"space-y-4",children:[(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Group Name"}),(0,c.jsx)("input",{type:"text",value:w.name,onChange:e=>C((0,r.A)((0,r.A)({},w),{},{name:e.target.value})),className:"w-full px-3 py-2 bg-dark-800 border border-dark-600 rounded-lg text-white focus:border-accent-cyan focus:outline-none",required:!0})]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Description"}),(0,c.jsx)("textarea",{value:w.description,onChange:e=>C((0,r.A)((0,r.A)({},w),{},{description:e.target.value})),rows:3,className:"w-full px-3 py-2 bg-dark-800 border border-dark-600 rounded-lg text-white focus:border-accent-cyan focus:outline-none"})]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Parent Group (optional)"}),(0,c.jsxs)("select",{value:w.parent_group_id,onChange:e=>C((0,r.A)((0,r.A)({},w),{},{parent_group_id:e.target.value})),className:"w-full px-3 py-2 bg-dark-800 border border-dark-600 rounded-lg text-white focus:border-accent-cyan focus:outline-none",children:[(0,c.jsx)("option",{value:"",children:"No Parent (Root Group)"}),e.filter(e=>e.id!==(null===u||void 0===u?void 0:u.id)).map(e=>(0,c.jsx)("option",{value:e.id,children:e.name},e.id))]}),(0,c.jsx)("p",{className:"text-xs text-gray-400 mt-1",children:"Select a parent group to create a subgroup"})]})]}),(0,c.jsxs)("div",{className:"flex space-x-3 mt-6",children:[(0,c.jsx)(i.A,{type:"submit",variant:"primary",children:"Create Group"}),(0,c.jsx)(i.A,{type:"button",variant:"secondary",onClick:()=>v(!1),children:"Cancel"})]})]})})}),f&&(0,c.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:(0,c.jsx)(n.A,{className:"w-full max-w-md mx-4",children:(0,c.jsxs)("form",{onSubmit:async e=>{e.preventDefault();try{(await fetch("/api/users/groups/".concat(u.id),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(w)})).ok&&(b(!1),p(null),C({name:"",description:""}),_())}catch(s){console.error("Error updating group:",s)}},children:[(0,c.jsx)("h2",{className:"text-xl font-bold text-white mb-4",children:"Edit Group"}),(0,c.jsxs)("div",{className:"space-y-4",children:[(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Group Name"}),(0,c.jsx)("input",{type:"text",value:w.name,onChange:e=>C((0,r.A)((0,r.A)({},w),{},{name:e.target.value})),className:"w-full px-3 py-2 bg-dark-800 border border-dark-600 rounded-lg text-white focus:border-accent-cyan focus:outline-none",required:!0})]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Description"}),(0,c.jsx)("textarea",{value:w.description,onChange:e=>C((0,r.A)((0,r.A)({},w),{},{description:e.target.value})),rows:3,className:"w-full px-3 py-2 bg-dark-800 border border-dark-600 rounded-lg text-white focus:border-accent-cyan focus:outline-none"})]})]}),(0,c.jsxs)("div",{className:"flex space-x-3 mt-6",children:[(0,c.jsx)(i.A,{type:"submit",variant:"primary",children:"Update Group"}),(0,c.jsx)(i.A,{type:"button",variant:"secondary",onClick:()=>b(!1),children:"Cancel"})]})]})})})]})}}}]);
//# sourceMappingURL=282.68d7490b.chunk.js.map