"use strict";(self.webpackChunkmeshtastic_admin_frontend=self.webpackChunkmeshtastic_admin_frontend||[]).push([[368],{3368:(e,t,s)=>{s.r(t),s.d(t,{default:()=>o});var a=s(2555),l=s(5043),r=s(4117),n=s(6139),c=s(3230),i=s(5592),d=s(579);const o=()=>{const{t:e}=(0,r.Bd)(),{subscribe:t}=(0,n.h3)(),[s,o]=(0,l.useState)([]),[x,m]=(0,l.useState)({}),[h,u]=(0,l.useState)(!0),[g,p]=(0,l.useState)("active"),[b,y]=(0,l.useState)(null),[j,v]=(0,l.useState)(!1),[f,w]=(0,l.useState)(!1),[N,k]=(0,l.useState)({type:"",severity:"",zone:"",user:""}),[_,A]=(0,l.useState)({title:"",message:"",alert_type:"custom",severity:"medium",user_id:"",zone_id:"",target_groups:[]});(0,l.useEffect)(()=>{C(),z()},[g,N]),(0,l.useEffect)(()=>{const e=t("new_alert",e=>{const t=e.data;o(e=>[t,...e]),m(e=>(0,a.A)((0,a.A)({},e),{},{total_alerts:(e.total_alerts||0)+1,unacknowledged_alerts:(e.unacknowledged_alerts||0)+1}))}),s=t("statistics_update",e=>{e.data.alert_stats&&m(t=>(0,a.A)((0,a.A)({},t),e.data.alert_stats))});return()=>{e(),s()}},[t]);const C=async()=>{try{const e=new URLSearchParams({include_acknowledged:"history"===g?"true":"false",limit:"100"});N.type&&e.append("alert_type",N.type),N.severity&&e.append("severity",N.severity),N.zone&&e.append("zone_id",N.zone),N.user&&e.append("user_id",N.user);const t=await fetch("/api/alerts/?".concat(e)),s=await t.json();o(s.alerts||[])}catch(e){console.error("Error fetching alerts:",e)}finally{u(!1)}},z=async()=>{try{const e=await fetch("/api/alerts/stats/overview"),t=await e.json();m(t)}catch(e){console.error("Error fetching stats:",e)}},S=async e=>{try{(await fetch("/api/alerts/".concat(e,"/acknowledge"),{method:"PUT"})).ok&&(C(),z())}catch(t){console.error("Error acknowledging alert:",t)}},E=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";try{(await fetch("/api/alerts/".concat(e,"/resolve"),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({resolution_notes:t})})).ok&&(C(),z())}catch(s){console.error("Error resolving alert:",s)}},L=e=>({low:"bg-green-400/20 text-green-400 border-green-400/30",medium:"bg-yellow-400/20 text-yellow-400 border-yellow-400/30",high:"bg-orange-400/20 text-orange-400 border-orange-400/30",critical:"bg-red-400/20 text-red-400 border-red-400/30"}[e]||"bg-gray-400/20 text-gray-400 border-gray-400/30"),P=e=>new Date(e).toLocaleString();return h?(0,d.jsx)("div",{className:"flex items-center justify-center min-h-96",children:(0,d.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-accent-cyan"})}):(0,d.jsxs)("div",{className:"space-y-6",children:[(0,d.jsxs)("div",{className:"flex justify-between items-center",children:[(0,d.jsx)("h1",{className:"text-3xl font-bold text-white",children:e("alerts.management")}),(0,d.jsxs)(i.A,{onClick:()=>v(!0),variant:"primary",className:"flex items-center space-x-2",children:[(0,d.jsx)("span",{children:"+"}),(0,d.jsx)("span",{children:e("alerts.create_alert")})]})]}),(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,d.jsxs)(c.A,{className:"text-center",children:[(0,d.jsx)("div",{className:"text-2xl font-bold text-white",children:x.total_alerts||0}),(0,d.jsx)("div",{className:"text-sm text-gray-400",children:e("alerts.total")})]}),(0,d.jsxs)(c.A,{className:"text-center",children:[(0,d.jsx)("div",{className:"text-2xl font-bold text-red-400",children:x.unacknowledged_alerts||0}),(0,d.jsx)("div",{className:"text-sm text-gray-400",children:e("alerts.unacknowledged")})]}),(0,d.jsxs)(c.A,{className:"text-center",children:[(0,d.jsx)("div",{className:"text-2xl font-bold text-yellow-400",children:x.unresolved_alerts||0}),(0,d.jsx)("div",{className:"text-sm text-gray-400",children:e("alerts.unresolved")})]}),(0,d.jsxs)(c.A,{className:"text-center",children:[(0,d.jsx)("div",{className:"text-2xl font-bold text-green-400",children:x.recent_alerts||0}),(0,d.jsx)("div",{className:"text-sm text-gray-400",children:e("alerts.recent")})]})]}),(0,d.jsx)("div",{className:"flex space-x-1 bg-dark-800/50 p-1 rounded-lg",children:[{id:"active",label:e("alerts.active")},{id:"history",label:e("alerts.history")}].map(e=>(0,d.jsx)("button",{onClick:()=>p(e.id),className:"flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors ".concat(g===e.id?"bg-accent-cyan text-dark-900":"text-gray-300 hover:text-white"),children:e.label},e.id))}),(0,d.jsx)(c.A,{children:(0,d.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:e("alerts.type")}),(0,d.jsxs)("select",{value:N.type,onChange:e=>k((0,a.A)((0,a.A)({},N),{},{type:e.target.value})),className:"w-full px-3 py-2 bg-dark-800 border border-dark-600 rounded-lg text-white focus:border-accent-cyan focus:outline-none",children:[(0,d.jsx)("option",{value:"",children:e("alerts.all_types")}),(0,d.jsx)("option",{value:"zone_entry",children:e("alerts.zone_entry")}),(0,d.jsx)("option",{value:"zone_exit",children:e("alerts.zone_exit")}),(0,d.jsx)("option",{value:"speeding",children:e("alerts.speeding")}),(0,d.jsx)("option",{value:"battery_low",children:e("alerts.battery_low")}),(0,d.jsx)("option",{value:"offline",children:e("alerts.offline")}),(0,d.jsx)("option",{value:"custom",children:e("alerts.custom")})]})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:e("alerts.severity")}),(0,d.jsxs)("select",{value:N.severity,onChange:e=>k((0,a.A)((0,a.A)({},N),{},{severity:e.target.value})),className:"w-full px-3 py-2 bg-dark-800 border border-dark-600 rounded-lg text-white focus:border-accent-cyan focus:outline-none",children:[(0,d.jsx)("option",{value:"",children:e("alerts.severity.all")}),(0,d.jsx)("option",{value:"low",children:e("alerts.severity.low")}),(0,d.jsx)("option",{value:"medium",children:e("alerts.severity.medium")}),(0,d.jsx)("option",{value:"high",children:e("alerts.severity.high")}),(0,d.jsx)("option",{value:"critical",children:e("alerts.severity.critical")})]})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:e("zones.name")}),(0,d.jsx)("input",{type:"text",value:N.zone,onChange:e=>k((0,a.A)((0,a.A)({},N),{},{zone:e.target.value})),placeholder:e("alerts.zone_id"),className:"w-full px-3 py-2 bg-dark-800 border border-dark-600 rounded-lg text-white focus:border-accent-cyan focus:outline-none"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:e("users.name")}),(0,d.jsx)("input",{type:"text",value:N.user,onChange:e=>k((0,a.A)((0,a.A)({},N),{},{user:e.target.value})),placeholder:e("alerts.user_id"),className:"w-full px-3 py-2 bg-dark-800 border border-dark-600 rounded-lg text-white focus:border-accent-cyan focus:outline-none"})]})]})}),(0,d.jsx)(c.A,{children:(0,d.jsxs)("div",{className:"space-y-3",children:[s.map(t=>(0,d.jsx)("div",{className:"p-4 bg-dark-800/30 rounded-lg border border-dark-600 hover:border-accent-cyan/30 transition-colors cursor-pointer",onClick:()=>{y(t),w(!0)},children:(0,d.jsxs)("div",{className:"flex justify-between items-start",children:[(0,d.jsxs)("div",{className:"flex-1",children:[(0,d.jsxs)("div",{className:"flex items-center space-x-3 mb-2",children:[(0,d.jsx)("h3",{className:"font-semibold text-white",children:t.title}),(0,d.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium border ".concat(L(t.severity)),children:t.severity.toUpperCase()}),(0,d.jsx)("span",{className:"px-2 py-1 bg-dark-700 text-gray-300 rounded-full text-xs",children:t.alert_type.replace("_"," ").toUpperCase()})]}),(0,d.jsx)("p",{className:"text-gray-300 text-sm mb-2",children:t.message}),(0,d.jsxs)("div",{className:"flex items-center space-x-4 text-xs text-gray-400",children:[(0,d.jsxs)("span",{children:[e("alerts.user"),": ",t.user_name||t.user_id]}),t.zone_name&&(0,d.jsxs)("span",{children:[e("alerts.zone"),": ",t.zone_name]}),(0,d.jsx)("span",{children:P(t.created_at)})]})]}),(0,d.jsxs)("div",{className:"flex space-x-2",children:[!t.is_acknowledged&&(0,d.jsx)("button",{onClick:e=>{e.stopPropagation(),S(t.id)},className:"px-3 py-1 bg-accent-cyan text-dark-900 rounded text-sm font-medium hover:bg-accent-cyan/80",children:e("alerts.acknowledge")}),!t.is_resolved&&(0,d.jsx)("button",{onClick:e=>{e.stopPropagation(),E(t.id)},className:"px-3 py-1 bg-green-600 text-white rounded text-sm font-medium hover:bg-green-500",children:e("alerts.resolve")})]})]})},t.id)),0===s.length&&(0,d.jsx)("p",{className:"text-gray-400 text-center py-8",children:e("alerts.no_alerts")})]})}),j&&(0,d.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:(0,d.jsx)(c.A,{className:"w-full max-w-2xl mx-4 max-h-[90vh] overflow-y-auto",children:(0,d.jsxs)("form",{onSubmit:async e=>{e.preventDefault();try{(await fetch("/api/alerts/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(_)})).ok&&(v(!1),A({title:"",message:"",alert_type:"custom",severity:"medium",user_id:"",zone_id:"",target_groups:[]}),C(),z())}catch(t){console.error("Error creating alert:",t)}},children:[(0,d.jsx)("h2",{className:"text-xl font-bold text-white mb-4",children:e("alerts.create_new_alert")}),(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:e("alerts.message")}),(0,d.jsx)("input",{type:"text",value:_.title,onChange:e=>A((0,a.A)((0,a.A)({},_),{},{title:e.target.value})),className:"w-full px-3 py-2 bg-dark-800 border border-dark-600 rounded-lg text-white focus:border-accent-cyan focus:outline-none",required:!0})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:e("alerts.alertType")}),(0,d.jsxs)("select",{value:_.alert_type,onChange:e=>A((0,a.A)((0,a.A)({},_),{},{alert_type:e.target.value})),className:"w-full px-3 py-2 bg-dark-800 border border-dark-600 rounded-lg text-white focus:border-accent-cyan focus:outline-none",children:[(0,d.jsx)("option",{value:"custom",children:e("alerts.custom")}),(0,d.jsx)("option",{value:"emergency",children:e("alerts.emergency")}),(0,d.jsx)("option",{value:"maintenance",children:e("alerts.maintenance")}),(0,d.jsx)("option",{value:"info",children:e("alerts.info")})]})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:e("alerts.severity")}),(0,d.jsxs)("select",{value:_.severity,onChange:e=>A((0,a.A)((0,a.A)({},_),{},{severity:e.target.value})),className:"w-full px-3 py-2 bg-dark-800 border border-dark-600 rounded-lg text-white focus:border-accent-cyan focus:outline-none",children:[(0,d.jsx)("option",{value:"low",children:e("alerts.severity.low")}),(0,d.jsx)("option",{value:"medium",children:e("alerts.severity.medium")}),(0,d.jsx)("option",{value:"high",children:e("alerts.severity.high")}),(0,d.jsx)("option",{value:"critical",children:e("alerts.severity.critical")})]})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:e("alerts.target_user")}),(0,d.jsx)("input",{type:"text",value:_.user_id,onChange:e=>A((0,a.A)((0,a.A)({},_),{},{user_id:e.target.value})),placeholder:e("alerts.user_id"),className:"w-full px-3 py-2 bg-dark-800 border border-dark-600 rounded-lg text-white focus:border-accent-cyan focus:outline-none"})]})]}),(0,d.jsxs)("div",{className:"mt-4",children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:e("alerts.message")}),(0,d.jsx)("textarea",{value:_.message,onChange:e=>A((0,a.A)((0,a.A)({},_),{},{message:e.target.value})),rows:4,className:"w-full px-3 py-2 bg-dark-800 border border-dark-600 rounded-lg text-white focus:border-accent-cyan focus:outline-none",required:!0})]}),(0,d.jsxs)("div",{className:"flex space-x-3 mt-6",children:[(0,d.jsx)(i.A,{type:"submit",variant:"primary",children:e("alerts.create_alert")}),(0,d.jsx)(i.A,{type:"button",variant:"secondary",onClick:()=>v(!1),children:e("common.cancel")})]})]})})}),f&&b&&(0,d.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:(0,d.jsxs)(c.A,{className:"w-full max-w-2xl mx-4 max-h-[90vh] overflow-y-auto",children:[(0,d.jsxs)("div",{className:"flex justify-between items-start mb-4",children:[(0,d.jsx)("h2",{className:"text-xl font-bold text-white",children:e("alerts.alert_details")}),(0,d.jsx)("button",{onClick:()=>w(!1),className:"text-gray-400 hover:text-white",children:(0,d.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,d.jsxs)("div",{className:"space-y-4",children:[(0,d.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:e("alerts.message")}),(0,d.jsx)("p",{className:"text-white",children:b.title})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:e("alerts.severity")}),(0,d.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium border ".concat(L(b.severity)),children:e("alerts.severity.".concat(b.severity))})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:e("alerts.type")}),(0,d.jsx)("p",{className:"text-white",children:e("alerts.".concat(b.alert_type))})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:e("alerts.status")}),(0,d.jsxs)("div",{className:"flex space-x-2",children:[(0,d.jsx)("span",{className:"px-2 py-1 rounded text-xs ".concat(b.is_acknowledged?"bg-green-600":"bg-red-600"),children:b.is_acknowledged?e("alerts.acknowledged"):e("alerts.unacknowledged")}),(0,d.jsx)("span",{className:"px-2 py-1 rounded text-xs ".concat(b.is_resolved?"bg-green-600":"bg-yellow-600"),children:b.is_resolved?e("alerts.resolved"):e("alerts.unresolved")})]})]})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:e("alerts.message")}),(0,d.jsx)("p",{className:"text-white bg-dark-800/50 p-3 rounded",children:b.message})]}),(0,d.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:e("alerts.user")}),(0,d.jsx)("p",{className:"text-white",children:b.user_name||b.user_id})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:e("alerts.zone")}),(0,d.jsx)("p",{className:"text-white",children:b.zone_name||e("alerts.n_a")})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:e("alerts.created")}),(0,d.jsx)("p",{className:"text-white",children:P(b.created_at)})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:e("alerts.acknowledged")}),(0,d.jsx)("p",{className:"text-white",children:b.acknowledged_at?P(b.acknowledged_at):e("alerts.unacknowledged").toLowerCase()})]})]}),b.acknowledged_by_username&&(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:e("alerts.acknowledged_by")}),(0,d.jsx)("p",{className:"text-white",children:b.acknowledged_by_username})]}),(0,d.jsxs)("div",{className:"flex space-x-3 pt-4",children:[!b.is_acknowledged&&(0,d.jsx)(i.A,{onClick:()=>{S(b.id),w(!1)},variant:"primary",children:e("alerts.acknowledge")}),!b.is_resolved&&(0,d.jsx)(i.A,{onClick:()=>{E(b.id,e("alerts.resolved_from_details")),w(!1)},variant:"secondary",children:e("alerts.resolve")})]})]})]})})]})}}}]);
//# sourceMappingURL=368.735d6d6f.chunk.js.map