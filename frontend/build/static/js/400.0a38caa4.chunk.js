"use strict";(self.webpackChunkmeshtastic_admin_frontend=self.webpackChunkmeshtastic_admin_frontend||[]).push([[400],{3400:(e,s,t)=>{t.r(s),t.d(s,{default:()=>p});var r=t(5043),a=t(4117),c=t(3230),l=t(2555),n=t(579);const i=e=>{let{onStatsUpdate:s}=e;const{t:t}=(0,a.Bd)(),[i,o]=(0,r.useState)([]),[d,x]=(0,r.useState)(!0),[m,p]=(0,r.useState)({active_only:!0,template_id:"",created_by:""});(0,r.useEffect)(()=>{u()},[m]);const u=async()=>{try{const e=new URLSearchParams;null!==m.active_only&&e.append("active_only",m.active_only),m.template_id&&e.append("template_id",m.template_id),m.created_by&&e.append("created_by",m.created_by);const s=await fetch("/api/processes/?".concat(e)),t=await s.json();o(t.processes||[])}catch(e){console.error("Error fetching processes:",e)}finally{x(!1)}},h=e=>new Date(e).toLocaleString();return d?(0,n.jsx)("div",{className:"flex items-center justify-center min-h-96",children:(0,n.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-accent-cyan"})}):(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsx)(c.A,{children:(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:t("processList.status")}),(0,n.jsxs)("select",{value:m.active_only,onChange:e=>p((0,l.A)((0,l.A)({},m),{},{active_only:"true"===e.target.value})),className:"w-full px-3 py-2 bg-dark-800 border border-dark-600 rounded-lg text-white focus:border-accent-cyan focus:outline-none",children:[(0,n.jsx)("option",{value:!0,children:t("processList.active_only")}),(0,n.jsx)("option",{value:!1,children:t("processList.all_processes")})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:t("processList.template_id")}),(0,n.jsx)("input",{type:"text",value:m.template_id,onChange:e=>p((0,l.A)((0,l.A)({},m),{},{template_id:e.target.value})),placeholder:t("processList.filter_by_template"),className:"w-full px-3 py-2 bg-dark-800 border border-dark-600 rounded-lg text-white focus:border-accent-cyan focus:outline-none"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:t("processList.created_by")}),(0,n.jsx)("input",{type:"text",value:m.created_by,onChange:e=>p((0,l.A)((0,l.A)({},m),{},{created_by:e.target.value})),placeholder:t("processList.filter_by_creator"),className:"w-full px-3 py-2 bg-dark-800 border border-dark-600 rounded-lg text-white focus:border-accent-cyan focus:outline-none"})]})]})}),(0,n.jsx)(c.A,{children:(0,n.jsxs)("div",{className:"space-y-3",children:[i.map(e=>{var r;return(0,n.jsx)("div",{className:"p-4 bg-dark-800/30 rounded-lg border border-dark-600 hover:border-accent-cyan/30 transition-colors",children:(0,n.jsxs)("div",{className:"flex justify-between items-start",children:[(0,n.jsxs)("div",{className:"flex-1",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-3 mb-2",children:[(0,n.jsx)("h3",{className:"font-semibold text-white",children:e.name}),(0,n.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat(e.is_active?"bg-green-400/20 text-green-400":"bg-red-400/20 text-red-400"),children:e.is_active?t("processList.active"):t("processList.inactive")})]}),(0,n.jsx)("p",{className:"text-gray-300 text-sm mb-2",children:e.description}),(0,n.jsxs)("div",{className:"flex items-center space-x-4 text-xs text-gray-400",children:[(0,n.jsxs)("span",{children:[t("processList.executions")," ",e.execution_count]}),(0,n.jsxs)("span",{children:[t("processList.success_rate")," ",(null===(r=e.success_rate)||void 0===r?void 0:r.toFixed(1))||0,"%"]}),(0,n.jsxs)("span",{children:[t("processList.created")," ",h(e.created_at)]}),e.last_executed&&(0,n.jsxs)("span",{children:[t("processList.last_run")," ",h(e.last_executed)]})]}),(0,n.jsxs)("div",{className:"flex items-center space-x-4 text-xs text-gray-400 mt-1",children:[(0,n.jsxs)("span",{children:[t("processList.by")," ",e.created_by_username]}),e.template_name&&(0,n.jsxs)("span",{children:[t("processList.template")," ",e.template_name]})]})]}),(0,n.jsxs)("div",{className:"flex space-x-2",children:[(0,n.jsx)("button",{onClick:()=>(async e=>{try{(await fetch("/api/processes/".concat(e,"/execute"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({trigger_data:{manual:!0}})})).ok&&(alert(t("processList.executed_successfully")),u(),s&&s())}catch(r){console.error("Error executing process:",r),alert(t("processList.error_executing"))}})(e.id),className:"px-3 py-1 bg-accent-cyan text-dark-900 rounded text-sm font-medium hover:bg-accent-cyan/80",children:t("processList.execute")}),e.is_active&&(0,n.jsx)("button",{onClick:()=>(async e=>{try{(await fetch("/api/processes/".concat(e),{method:"DELETE"})).ok&&(u(),s&&s())}catch(r){console.error("Error deactivating process:",r),alert(t("processList.error_deactivating"))}})(e.id),className:"px-3 py-1 bg-red-600 text-white rounded text-sm font-medium hover:bg-red-500",children:t("processList.deactivate")})]})]})},e.id)}),0===i.length&&(0,n.jsx)("p",{className:"text-gray-400 text-center py-8",children:t("processList.no_processes")})]})})]})};var o=t(5592);const d=e=>{let{onStatsUpdate:s}=e;const{t:t}=(0,a.Bd)(),[i,d]=(0,r.useState)({name:"",description:"",triggers:[],actions:[]}),[x,m]=(0,r.useState)([]),[p,u]=(0,r.useState)(!1);(0,r.useEffect)(()=>{h()},[]);const h=async()=>{try{const e=await fetch("/api/processes/templates/"),s=await e.json();m(s.templates||[])}catch(e){console.error("Error fetching templates:",e)}},g=(e,s,t)=>{const r=[...i.triggers];r[e]=(0,l.A)((0,l.A)({},r[e]),{},{[s]:t}),d((0,l.A)((0,l.A)({},i),{},{triggers:r}))},b=(e,s,t)=>{const r=[...i.actions];r[e]=(0,l.A)((0,l.A)({},r[e]),{},{[s]:t}),d((0,l.A)((0,l.A)({},i),{},{actions:r}))};return(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center",children:[(0,n.jsx)("h2",{className:"text-2xl font-bold text-white",children:t("processBuilder.title")}),(0,n.jsx)(o.A,{onClick:()=>u(!0),variant:"secondary",children:t("processBuilder.load_template")})]}),(0,n.jsxs)("form",{onSubmit:async e=>{e.preventDefault();try{(await fetch("/api/processes/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)})).ok&&(alert(t("processBuilder.process_created")),d({name:"",description:"",triggers:[],actions:[]}),s&&s())}catch(r){console.error("Error creating process:",r),alert(t("processBuilder.error_creating"))}},children:[(0,n.jsxs)(c.A,{children:[(0,n.jsx)("h3",{className:"text-lg font-semibold text-white mb-4",children:t("processBuilder.process_info")}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:t("processBuilder.process_name")}),(0,n.jsx)("input",{type:"text",value:i.name,onChange:e=>d((0,l.A)((0,l.A)({},i),{},{name:e.target.value})),className:"w-full px-3 py-2 bg-dark-800 border border-dark-600 rounded-lg text-white focus:border-accent-cyan focus:outline-none",required:!0})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:t("processBuilder.description")}),(0,n.jsx)("input",{type:"text",value:i.description,onChange:e=>d((0,l.A)((0,l.A)({},i),{},{description:e.target.value})),className:"w-full px-3 py-2 bg-dark-800 border border-dark-600 rounded-lg text-white focus:border-accent-cyan focus:outline-none"})]})]})]}),(0,n.jsxs)(c.A,{children:[(0,n.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,n.jsx)("h3",{className:"text-lg font-semibold text-white",children:t("processBuilder.triggers")}),(0,n.jsx)(o.A,{type:"button",onClick:()=>{d((0,l.A)((0,l.A)({},i),{},{triggers:[...i.triggers,{trigger_type:"manual",trigger_config:{},conditions:{},priority:0,is_active:!0}]}))},variant:"secondary",className:"text-sm",children:t("processBuilder.add_trigger")})]}),(0,n.jsxs)("div",{className:"space-y-3",children:[i.triggers.map((e,s)=>(0,n.jsx)("div",{className:"p-4 bg-dark-800/50 rounded-lg",children:(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:t("processBuilder.trigger_type")}),(0,n.jsxs)("select",{value:e.trigger_type,onChange:e=>g(s,"trigger_type",e.target.value),className:"w-full px-3 py-2 bg-dark-800 border border-dark-600 rounded-lg text-white focus:border-accent-cyan focus:outline-none",children:[(0,n.jsx)("option",{value:"manual",children:t("processBuilder.manual")}),(0,n.jsx)("option",{value:"zone_entry",children:t("processBuilder.zone_entry")}),(0,n.jsx)("option",{value:"zone_exit",children:t("processBuilder.zone_exit")}),(0,n.jsx)("option",{value:"alert_created",children:t("processBuilder.alert_created")}),(0,n.jsx)("option",{value:"message_received",children:t("processBuilder.message_received")}),(0,n.jsx)("option",{value:"time_schedule",children:t("processBuilder.time_schedule")})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:t("processBuilder.priority")}),(0,n.jsx)("input",{type:"number",value:e.priority,onChange:e=>g(s,"priority",parseInt(e.target.value)),className:"w-full px-3 py-2 bg-dark-800 border border-dark-600 rounded-lg text-white focus:border-accent-cyan focus:outline-none"})]}),(0,n.jsx)("div",{className:"flex items-end",children:(0,n.jsx)("button",{type:"button",onClick:()=>(e=>{d((0,l.A)((0,l.A)({},i),{},{triggers:i.triggers.filter((s,t)=>t!==e)}))})(s),className:"px-3 py-2 bg-red-600 text-white rounded text-sm font-medium hover:bg-red-500",children:t("processBuilder.remove")})})]})},s)),0===i.triggers.length&&(0,n.jsx)("p",{className:"text-gray-400 text-center py-4",children:t("processBuilder.no_triggers")})]})]}),(0,n.jsxs)(c.A,{children:[(0,n.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,n.jsx)("h3",{className:"text-lg font-semibold text-white",children:t("processBuilder.actions")}),(0,n.jsx)(o.A,{type:"button",onClick:()=>{d((0,l.A)((0,l.A)({},i),{},{actions:[...i.actions,{action_type:"send_message",action_config:{},conditions:{},action_order:i.actions.length+1,timeout_seconds:30,retry_count:0}]}))},variant:"secondary",className:"text-sm",children:t("processBuilder.add_action")})]}),(0,n.jsxs)("div",{className:"space-y-3",children:[i.actions.map((e,s)=>(0,n.jsx)("div",{className:"p-4 bg-dark-800/50 rounded-lg",children:(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:t("processBuilder.action_type")}),(0,n.jsxs)("select",{value:e.action_type,onChange:e=>b(s,"action_type",e.target.value),className:"w-full px-3 py-2 bg-dark-800 border border-dark-600 rounded-lg text-white focus:border-accent-cyan focus:outline-none",children:[(0,n.jsx)("option",{value:"send_message",children:t("processBuilder.send_message")}),(0,n.jsx)("option",{value:"create_alert",children:t("processBuilder.create_alert")}),(0,n.jsx)("option",{value:"update_zone",children:t("processBuilder.update_zone")}),(0,n.jsx)("option",{value:"trigger_bot",children:t("processBuilder.trigger_bot")}),(0,n.jsx)("option",{value:"update_group",children:t("processBuilder.update_group")}),(0,n.jsx)("option",{value:"send_notification",children:t("processBuilder.send_notification")})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:t("processBuilder.order")}),(0,n.jsx)("input",{type:"number",value:e.action_order,onChange:e=>b(s,"action_order",parseInt(e.target.value)),className:"w-full px-3 py-2 bg-dark-800 border border-dark-600 rounded-lg text-white focus:border-accent-cyan focus:outline-none"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:t("processBuilder.timeout_s")}),(0,n.jsx)("input",{type:"number",value:e.timeout_seconds,onChange:e=>b(s,"timeout_seconds",parseInt(e.target.value)),className:"w-full px-3 py-2 bg-dark-800 border border-dark-600 rounded-lg text-white focus:border-accent-cyan focus:outline-none"})]}),(0,n.jsx)("div",{className:"flex items-end",children:(0,n.jsx)("button",{type:"button",onClick:()=>(e=>{d((0,l.A)((0,l.A)({},i),{},{actions:i.actions.filter((s,t)=>t!==e)}))})(s),className:"px-3 py-2 bg-red-600 text-white rounded text-sm font-medium hover:bg-red-500",children:t("processBuilder.remove")})})]})},s)),0===i.actions.length&&(0,n.jsx)("p",{className:"text-gray-400 text-center py-4",children:t("processBuilder.no_actions")})]})]}),(0,n.jsx)("div",{className:"flex space-x-3",children:(0,n.jsx)(o.A,{type:"submit",variant:"primary",children:t("processBuilder.create_process")})})]}),p&&(0,n.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:(0,n.jsxs)(c.A,{className:"w-full max-w-2xl mx-4 max-h-[80vh] overflow-y-auto",children:[(0,n.jsxs)("div",{className:"flex justify-between items-start mb-4",children:[(0,n.jsx)("h2",{className:"text-xl font-bold text-white",children:t("processBuilder.load_from_template")}),(0,n.jsx)("button",{onClick:()=>u(!1),className:"text-gray-400 hover:text-white",children:(0,n.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,n.jsxs)("div",{className:"space-y-3",children:[x.map(e=>(0,n.jsx)("div",{className:"p-4 bg-dark-800/50 rounded-lg border border-dark-600 hover:border-accent-cyan/30 transition-colors",children:(0,n.jsxs)("div",{className:"flex justify-between items-start",children:[(0,n.jsxs)("div",{className:"flex-1",children:[(0,n.jsx)("h3",{className:"font-semibold text-white",children:e.name}),(0,n.jsx)("p",{className:"text-gray-300 text-sm",children:e.description}),(0,n.jsxs)("div",{className:"flex items-center space-x-4 text-xs text-gray-400 mt-2",children:[(0,n.jsxs)("span",{children:[t("processBuilder.category"),": ",e.category]}),(0,n.jsxs)("span",{children:[t("processBuilder.usage"),": ",e.usage_count]})]})]}),(0,n.jsx)(o.A,{onClick:()=>(async e=>{try{var r;(await fetch("/api/processes/templates/".concat(e,"/instantiate"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:"".concat(t("processBuilder.new_process_from")," ").concat(null===(r=x.find(s=>s.id===e))||void 0===r?void 0:r.name),description:t("processBuilder.created_from_template")})})).ok&&(alert(t("processBuilder.process_from_template")),u(!1),s&&s())}catch(a){console.error("Error creating process from template:",a),alert(t("processBuilder.error_from_template"))}})(e.id),variant:"primary",className:"text-sm",children:t("processBuilder.use_template")})]})},e.id)),0===x.length&&(0,n.jsx)("p",{className:"text-gray-400 text-center py-8",children:t("processBuilder.no_templates")})]})]})})]})},x=e=>{let{onStatsUpdate:s}=e;const{t:t}=(0,a.Bd)(),[i,o]=(0,r.useState)([]),[d,x]=(0,r.useState)(!0),[m,p]=(0,r.useState)(null),[u,h]=(0,r.useState)(!1),[g,b]=(0,r.useState)({process_id:"",status:""});(0,r.useEffect)(()=>{j()},[g]);const j=async()=>{try{const e=new URLSearchParams;g.process_id&&e.append("process_id",g.process_id),g.status&&e.append("status",g.status);const s=await fetch("/api/processes/executions/?".concat(e)),t=await s.json();o(t.executions||[])}catch(e){console.error("Error fetching executions:",e)}finally{x(!1)}},y=e=>({running:"bg-blue-400/20 text-blue-400 border-blue-400/30",completed:"bg-green-400/20 text-green-400 border-green-400/30",failed:"bg-red-400/20 text-red-400 border-red-400/30",timeout:"bg-yellow-400/20 text-yellow-400 border-yellow-400/30"}[e]||"bg-gray-400/20 text-gray-400 border-gray-400/30"),f=e=>new Date(e).toLocaleString(),v=(e,s)=>{if(!s)return t("processMonitor.running_duration");const r=new Date(s)-new Date(e);return"".concat((r/1e3).toFixed(2),"s")};return d?(0,n.jsx)("div",{className:"flex items-center justify-center min-h-96",children:(0,n.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-accent-cyan"})}):(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsx)(c.A,{children:(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:t("processMonitor.process_id")}),(0,n.jsx)("input",{type:"text",value:g.process_id,onChange:e=>b((0,l.A)((0,l.A)({},g),{},{process_id:e.target.value})),placeholder:t("processMonitor.filter_process"),className:"w-full px-3 py-2 bg-dark-800 border border-dark-600 rounded-lg text-white focus:border-accent-cyan focus:outline-none"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:t("processMonitor.status")}),(0,n.jsxs)("select",{value:g.status,onChange:e=>b((0,l.A)((0,l.A)({},g),{},{status:e.target.value})),className:"w-full px-3 py-2 bg-dark-800 border border-dark-600 rounded-lg text-white focus:border-accent-cyan focus:outline-none",children:[(0,n.jsx)("option",{value:"",children:t("processMonitor.all_statuses")}),(0,n.jsx)("option",{value:"running",children:t("processMonitor.running")}),(0,n.jsx)("option",{value:"completed",children:t("processMonitor.completed")}),(0,n.jsx)("option",{value:"failed",children:t("processMonitor.failed")}),(0,n.jsx)("option",{value:"timeout",children:t("processMonitor.timeout")})]})]})]})}),(0,n.jsx)(c.A,{children:(0,n.jsxs)("div",{className:"space-y-3",children:[i.map(e=>(0,n.jsx)("div",{className:"p-4 bg-dark-800/30 rounded-lg border border-dark-600 hover:border-accent-cyan/30 transition-colors cursor-pointer",onClick:()=>(async e=>{try{const s=await fetch("/api/processes/executions/".concat(e)),t=await s.json();p(t),h(!0)}catch(s){console.error("Error fetching execution details:",s)}})(e.id),children:(0,n.jsx)("div",{className:"flex justify-between items-start",children:(0,n.jsxs)("div",{className:"flex-1",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-3 mb-2",children:[(0,n.jsx)("h3",{className:"font-semibold text-white",children:e.process_name}),(0,n.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium border ".concat(y(e.status)),children:e.status.toUpperCase()})]}),(0,n.jsxs)("div",{className:"flex items-center space-x-4 text-xs text-gray-400",children:[(0,n.jsxs)("span",{children:[t("processMonitor.execution_id")," ",e.id]}),(0,n.jsxs)("span",{children:[t("processMonitor.triggered_by")," ",e.triggered_by_username||e.triggered_by]}),(0,n.jsxs)("span",{children:[t("processMonitor.started")," ",f(e.started_at)]}),e.completed_at&&(0,n.jsxs)("span",{children:[t("processMonitor.duration")," ",v(e.started_at,e.completed_at)]})]}),(0,n.jsxs)("div",{className:"flex items-center space-x-4 text-xs text-gray-400 mt-1",children:[(0,n.jsxs)("span",{children:[t("processMonitor.steps")," ",e.steps_completed,"/",e.total_steps||"N/A"]}),e.execution_time_ms&&(0,n.jsxs)("span",{children:[t("processMonitor.time")," ",(e.execution_time_ms/1e3).toFixed(2),"s"]})]}),e.error_message&&(0,n.jsxs)("div",{className:"mt-2 p-2 bg-red-900/20 border border-red-600 rounded text-xs text-red-400",children:[t("processMonitor.error")," ",e.error_message]})]})})},e.id)),0===i.length&&(0,n.jsx)("p",{className:"text-gray-400 text-center py-8",children:t("processMonitor.no_executions")})]})}),u&&m&&(0,n.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:(0,n.jsxs)(c.A,{className:"w-full max-w-4xl mx-4 max-h-[90vh] overflow-y-auto",children:[(0,n.jsxs)("div",{className:"flex justify-between items-start mb-4",children:[(0,n.jsx)("h2",{className:"text-xl font-bold text-white",children:t("processMonitor.details")}),(0,n.jsx)("button",{onClick:()=>h(!1),className:"text-gray-400 hover:text-white",children:(0,n.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:t("processMonitor.process")}),(0,n.jsx)("p",{className:"text-white",children:m.process_name})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:t("processMonitor.status_label")}),(0,n.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium border ".concat(y(m.status)),children:m.status.toUpperCase()})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:t("processMonitor.started_label")}),(0,n.jsx)("p",{className:"text-white",children:f(m.started_at)})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:t("processMonitor.completed")}),(0,n.jsx)("p",{className:"text-white",children:m.completed_at?f(m.completed_at):t("processMonitor.not_completed")})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:t("processMonitor.triggered_by_label")}),(0,n.jsx)("p",{className:"text-white",children:m.triggered_by})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:t("processMonitor.duration_label")}),(0,n.jsx)("p",{className:"text-white",children:v(m.started_at,m.completed_at)})]})]}),m.trigger_event&&(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:t("processMonitor.trigger_event")}),(0,n.jsx)("pre",{className:"text-white bg-dark-800/50 p-3 rounded text-xs overflow-x-auto",children:JSON.stringify(JSON.parse(m.trigger_event),null,2)})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:t("processMonitor.execution_steps")}),(0,n.jsxs)("div",{className:"space-y-2",children:[m.steps&&m.steps.map((e,s)=>(0,n.jsx)("div",{className:"p-3 bg-dark-800/30 rounded border border-dark-600",children:(0,n.jsx)("div",{className:"flex justify-between items-start",children:(0,n.jsxs)("div",{className:"flex-1",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-3 mb-2",children:[(0,n.jsxs)("span",{className:"font-medium text-white",children:[t("processMonitor.step")," ",s+1]}),(0,n.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium border ".concat(y(e.status)),children:e.status.toUpperCase()}),(0,n.jsx)("span",{className:"text-gray-400 text-sm",children:e.action_type})]}),(0,n.jsxs)("div",{className:"text-xs text-gray-400",children:[t("processMonitor.started"),": ",f(e.started_at),e.completed_at&&" | ".concat(t("processMonitor.completed"),": ").concat(f(e.completed_at)),e.execution_time_ms&&" | ".concat(t("processMonitor.duration"),": ").concat((e.execution_time_ms/1e3).toFixed(2),"s")]}),e.result&&(0,n.jsx)("pre",{className:"text-white bg-dark-900/50 p-2 rounded text-xs mt-2 overflow-x-auto",children:JSON.stringify(JSON.parse(e.result),null,2)}),e.error_message&&(0,n.jsxs)("div",{className:"mt-2 p-2 bg-red-900/20 border border-red-600 rounded text-xs text-red-400",children:[t("processMonitor.error")," ",e.error_message]})]})})},s)),(!m.steps||0===m.steps.length)&&(0,n.jsx)("p",{className:"text-gray-400 text-center py-4",children:t("processMonitor.no_steps")})]})]})]})]})})]})},m=e=>{let{onStatsUpdate:s}=e;const{t:t}=(0,a.Bd)(),[i,d]=(0,r.useState)([]),[x,m]=(0,r.useState)(!0),[p,u]=(0,r.useState)(!1),[h,g]=(0,r.useState)(null),[b,j]=(0,r.useState)(!1),[y,f]=(0,r.useState)({process_id:"",name:"",description:"",category:"emergency"});(0,r.useEffect)(()=>{v()},[]);const v=async()=>{try{const e=await fetch("/api/processes/templates/"),s=await e.json();d(s.templates||[])}catch(e){console.error("Error fetching templates:",e)}finally{m(!1)}},_=async function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";try{var a;const c=await fetch("/api/processes/templates/".concat(e,"/instantiate"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:r||"Process from ".concat(null===(a=i.find(s=>s.id===e))||void 0===a?void 0:a.name),description:"Created from template"})});c.ok&&(alert(t("processTemplates.process_from_template_success")),s&&s())}catch(c){console.error("Error instantiating template:",c),alert(t("processTemplates.error_from_template"))}},N=e=>({emergency:"text-red-400",maintenance:"text-yellow-400",communication:"text-blue-400",monitoring:"text-green-400"}[e]||"text-gray-400"),w=e=>new Date(e).toLocaleString();return x?(0,n.jsx)("div",{className:"flex items-center justify-center min-h-96",children:(0,n.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-accent-cyan"})}):(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center",children:[(0,n.jsx)("h2",{className:"text-2xl font-bold text-white",children:t("processTemplates.title")}),(0,n.jsx)(o.A,{onClick:()=>u(!0),variant:"primary",children:t("processTemplates.create_template")})]}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[i.map(e=>(0,n.jsxs)(c.A,{className:"cursor-pointer hover:border-accent-cyan/30 transition-colors",children:[(0,n.jsxs)("div",{onClick:()=>(e=>{g(e),j(!0)})(e),children:[(0,n.jsxs)("div",{className:"flex justify-between items-start mb-3",children:[(0,n.jsx)("h3",{className:"font-semibold text-white text-lg",children:e.name}),(0,n.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat(N(e.category)," bg-current/20"),children:e.category.toUpperCase()})]}),(0,n.jsx)("p",{className:"text-gray-300 text-sm mb-3",children:e.description}),(0,n.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-400",children:[(0,n.jsxs)("span",{children:[t("processTemplates.usage")," ",e.usage_count]}),(0,n.jsxs)("span",{children:[t("processTemplates.by")," ",e.created_by_username]})]}),(0,n.jsxs)("div",{className:"text-xs text-gray-400 mt-1",children:[t("processTemplates.created")," ",w(e.created_at)]})]}),(0,n.jsx)("div",{className:"flex space-x-2 mt-4",children:(0,n.jsx)(o.A,{onClick:s=>{s.stopPropagation();const r=prompt(t("processTemplates.enter_process_name"),"Process from ".concat(e.name));r&&_(e.id,r)},variant:"primary",className:"flex-1 text-sm",children:t("processTemplates.use_template")})})]},e.id)),0===i.length&&(0,n.jsx)("div",{className:"col-span-full",children:(0,n.jsx)(c.A,{children:(0,n.jsx)("p",{className:"text-gray-400 text-center py-8",children:t("processTemplates.no_templates")})})})]}),p&&(0,n.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:(0,n.jsx)(c.A,{className:"w-full max-w-lg mx-4",children:(0,n.jsxs)("form",{onSubmit:async e=>{e.preventDefault();try{(await fetch("/api/processes/templates/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(y)})).ok&&(alert(t("processTemplates.template_created")),u(!1),f({process_id:"",name:"",description:"",category:"emergency"}),v())}catch(s){console.error("Error creating template:",s),alert(t("processTemplates.error_creating_template"))}},children:[(0,n.jsx)("h2",{className:"text-xl font-bold text-white mb-4",children:t("processTemplates.create_process_template")}),(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Process ID"}),(0,n.jsx)("input",{type:"number",value:y.process_id,onChange:e=>f((0,l.A)((0,l.A)({},y),{},{process_id:e.target.value})),placeholder:"ID of existing process",className:"w-full px-3 py-2 bg-dark-800 border border-dark-600 rounded-lg text-white focus:border-accent-cyan focus:outline-none",required:!0})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:t("processTemplates.template_name")}),(0,n.jsx)("input",{type:"text",value:y.name,onChange:e=>f((0,l.A)((0,l.A)({},y),{},{name:e.target.value})),placeholder:t("processTemplates.template_name_placeholder"),className:"w-full px-3 py-2 bg-dark-800 border border-dark-600 rounded-lg text-white focus:border-accent-cyan focus:outline-none",required:!0})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:t("processTemplates.description")}),(0,n.jsx)("textarea",{value:y.description,onChange:e=>f((0,l.A)((0,l.A)({},y),{},{description:e.target.value})),placeholder:t("processTemplates.template_desc_placeholder"),rows:3,className:"w-full px-3 py-2 bg-dark-800 border border-dark-600 rounded-lg text-white focus:border-accent-cyan focus:outline-none"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:t("processTemplates.category")}),(0,n.jsxs)("select",{value:y.category,onChange:e=>f((0,l.A)((0,l.A)({},y),{},{category:e.target.value})),className:"w-full px-3 py-2 bg-dark-800 border border-dark-600 rounded-lg text-white focus:border-accent-cyan focus:outline-none",children:[(0,n.jsx)("option",{value:"emergency",children:t("processTemplates.emergency")}),(0,n.jsx)("option",{value:"maintenance",children:t("processTemplates.maintenance")}),(0,n.jsx)("option",{value:"communication",children:t("processTemplates.communication")}),(0,n.jsx)("option",{value:"monitoring",children:t("processTemplates.monitoring")})]})]})]}),(0,n.jsxs)("div",{className:"flex space-x-3 mt-6",children:[(0,n.jsx)(o.A,{type:"submit",variant:"primary",children:t("processTemplates.create_template_btn")}),(0,n.jsx)(o.A,{type:"button",variant:"secondary",onClick:()=>u(!1),children:t("processTemplates.cancel")})]})]})})}),b&&h&&(0,n.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:(0,n.jsxs)(c.A,{className:"w-full max-w-4xl mx-4 max-h-[90vh] overflow-y-auto",children:[(0,n.jsxs)("div",{className:"flex justify-between items-start mb-4",children:[(0,n.jsx)("h2",{className:"text-xl font-bold text-white",children:h.name}),(0,n.jsx)("button",{onClick:()=>j(!1),className:"text-gray-400 hover:text-white",children:(0,n.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:t("processTemplates.category_label")}),(0,n.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat(N(h.category)," bg-current/20"),children:h.category.toUpperCase()})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:t("processTemplates.usage_count")}),(0,n.jsx)("p",{className:"text-white",children:h.usage_count})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:t("processTemplates.created_by")}),(0,n.jsx)("p",{className:"text-white",children:h.created_by_username})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:t("processTemplates.created_label")}),(0,n.jsx)("p",{className:"text-white",children:w(h.created_at)})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:t("processTemplates.description_label")}),(0,n.jsx)("p",{className:"text-white bg-dark-800/50 p-3 rounded",children:h.description})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:t("processTemplates.template_structure")}),(0,n.jsx)("pre",{className:"text-white bg-dark-800/50 p-3 rounded text-xs overflow-x-auto max-h-96",children:JSON.stringify(JSON.parse(h.template_data),null,2)})]}),(0,n.jsx)("div",{className:"flex space-x-3 pt-4",children:(0,n.jsx)(o.A,{onClick:()=>{const e=prompt(t("processTemplates.enter_process_name"),"Process from ".concat(h.name));e&&(_(h.id,e),j(!1))},variant:"primary",children:t("processTemplates.create_process_from")})})]})]})})]})},p=()=>{var e,s;const{t:t}=(0,a.Bd)(),[l,o]=(0,r.useState)("list"),[p,u]=(0,r.useState)({});(0,r.useEffect)(()=>{h()},[]);const h=async()=>{try{const e=await fetch("/api/processes/analytics/overview"),s=await e.json();u(s)}catch(e){console.error("Error fetching process stats:",e)}},g=[{id:"list",label:t("processes.list"),component:i},{id:"builder",label:t("processes.builder"),component:d},{id:"monitor",label:t("processes.monitor"),component:x},{id:"templates",label:t("processes.templates"),component:m}],b=(null===(e=g.find(e=>e.id===l))||void 0===e?void 0:e.component)||i;return(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsx)("div",{className:"flex justify-between items-center",children:(0,n.jsx)("h1",{className:"text-3xl font-bold text-white",children:t("processes.management")})}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,n.jsxs)(c.A,{className:"text-center",children:[(0,n.jsx)("div",{className:"text-2xl font-bold text-white",children:p.total_processes||0}),(0,n.jsx)("div",{className:"text-sm text-gray-400",children:t("processes.total_processes")})]}),(0,n.jsxs)(c.A,{className:"text-center",children:[(0,n.jsx)("div",{className:"text-2xl font-bold text-blue-400",children:p.total_executions||0}),(0,n.jsx)("div",{className:"text-sm text-gray-400",children:t("processes.total_executions")})]}),(0,n.jsxs)(c.A,{className:"text-center",children:[(0,n.jsxs)("div",{className:"text-2xl font-bold text-green-400",children:[(null===(s=p.success_rate)||void 0===s?void 0:s.toFixed(1))||0,"%"]}),(0,n.jsx)("div",{className:"text-sm text-gray-400",children:t("processes.success_rate")})]}),(0,n.jsxs)(c.A,{className:"text-center",children:[(0,n.jsx)("div",{className:"text-2xl font-bold text-yellow-400",children:p.recent_executions||0}),(0,n.jsx)("div",{className:"text-sm text-gray-400",children:t("processes.recent_30d")})]})]}),(0,n.jsx)("div",{className:"flex space-x-1 bg-dark-800/50 p-1 rounded-lg",children:g.map(e=>(0,n.jsx)("button",{onClick:()=>o(e.id),className:"flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors ".concat(l===e.id?"bg-accent-cyan text-dark-900":"text-gray-300 hover:text-white"),children:e.label},e.id))}),(0,n.jsx)("div",{className:"mt-6",children:(0,n.jsx)(b,{onStatsUpdate:h})})]})}}}]);
//# sourceMappingURL=400.0a38caa4.chunk.js.map