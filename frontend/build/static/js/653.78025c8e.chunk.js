/*! For license information please see 653.78025c8e.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunkmeshtastic_admin_frontend=self.webpackChunkmeshtastic_admin_frontend||[]).push([[653],{653:(e,s,t)=>{t.r(s),t.d(s,{default:()=>h});var a=t(2555),n=t(5043),i=t(4117),c=t(6139),r=t(3230),d=t(4669);const l=(0,t(1639).A)("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);var m=t(4459),x=t(5088),o=t(579);const h=()=>{var e;const{t:s}=(0,i.Bd)(),{subscribe:t,isConnected:h}=(0,c.h3)(),[g,p]=(0,n.useState)([]),[j,u]=(0,n.useState)({total_messages:0,messages_today:0,active_conversations:0}),[_,b]=(0,n.useState)(!0),[v,y]=(0,n.useState)(null);(0,n.useEffect)(()=>{f(),N()},[]),(0,n.useEffect)(()=>{const e=t("new_message",e=>{const s={id:e.data.id||Date.now(),sender_id:e.data.sender_id,sender_name:e.data.sender_name||e.data.sender_id,recipient_id:e.data.receiver_id,recipient_name:e.data.recipient_name||e.data.receiver_id,content:e.data.text||e.data.content,message_type:"outgoing"===e.data.direction?"sent":"received",created_at:e.data.timestamp||(new Date).toISOString(),is_bot_response:e.data.is_bot_response||!1};p(e=>[s,...e.slice(0,49)]),u(e=>(0,a.A)((0,a.A)({},e),{},{total_messages:e.total_messages+1,messages_today:e.messages_today+1}))}),s=t("statistics_update",e=>{e.data.message_stats&&u(s=>(0,a.A)((0,a.A)({},s),e.data.message_stats))});return()=>{e(),s()}},[t]);const f=async()=>{try{const e=await fetch("/api/messages/?limit=50&offset=0"),s=((await e.json()).messages||[]).map(e=>({id:e.id,sender_id:e.sender_id,sender_name:e.sender_id,recipient_id:e.receiver_id,recipient_name:e.receiver_id,content:e.text,message_type:"outgoing"===e.direction?"sent":"received",created_at:e.timestamp,is_bot_response:!1}));p(s)}catch(e){console.error("Error fetching messages:",e)}finally{b(!1)}},N=async()=>{try{const e=await fetch("/api/messages/stats/overview"),s=await e.json();u(e=>(0,a.A)((0,a.A)({},e),s))}catch(e){console.error("Error fetching message stats:",e)}},w=e=>new Date(e).toLocaleString(),k=e=>({text:"text-blue-400",location:"text-green-400",alert:"text-red-400",command:"text-purple-400",system:"text-gray-400"}[e]||"text-gray-400");return _?(0,o.jsx)("div",{className:"flex items-center justify-center min-h-96",children:(0,o.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-accent-cyan"})}):(0,o.jsxs)("div",{className:"space-y-6",children:[(0,o.jsxs)("div",{className:"flex justify-between items-center",children:[(0,o.jsx)("h1",{className:"text-3xl font-bold text-white",children:s("messages.monitoring")}),(0,o.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,o.jsx)("div",{className:"w-2 h-2 rounded-full ".concat(h?"bg-green-400":"bg-red-400")}),(0,o.jsx)("span",{className:"text-sm text-gray-400",children:s(h?"messages.live_updates":"status.disconnected")})]})]}),(0,o.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,o.jsxs)(r.A,{className:"text-center",children:[(0,o.jsx)(d.A,{className:"w-8 h-8 text-accent-cyan mx-auto mb-2"}),(0,o.jsx)("div",{className:"text-2xl font-bold text-white",children:j.total_messages}),(0,o.jsx)("div",{className:"text-sm text-gray-400",children:s("messages.total_messages")})]}),(0,o.jsxs)(r.A,{className:"text-center",children:[(0,o.jsx)(l,{className:"w-8 h-8 text-accent-green mx-auto mb-2"}),(0,o.jsx)("div",{className:"text-2xl font-bold text-white",children:j.messages_today}),(0,o.jsx)("div",{className:"text-sm text-gray-400",children:s("messages.messages_today")})]}),(0,o.jsxs)(r.A,{className:"text-center",children:[(0,o.jsx)(m.A,{className:"w-8 h-8 text-accent-purple mx-auto mb-2"}),(0,o.jsx)("div",{className:"text-2xl font-bold text-white",children:j.active_conversations}),(0,o.jsx)("div",{className:"text-sm text-gray-400",children:s("messages.active_conversations")})]})]}),(0,o.jsx)(r.A,{title:s("messages.recent_messages"),children:(0,o.jsxs)("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:[g.map(e=>{var t;return(0,o.jsx)("div",{className:"p-4 bg-dark-800/30 rounded-lg border border-dark-600 hover:border-accent-cyan/30 transition-colors cursor-pointer",onClick:()=>y(e),children:(0,o.jsx)("div",{className:"flex justify-between items-start",children:(0,o.jsxs)("div",{className:"flex-1",children:[(0,o.jsxs)("div",{className:"flex items-center space-x-3 mb-2",children:[(0,o.jsx)("h3",{className:"font-semibold text-white",children:e.sender_name||s("messages.unknown")}),(0,o.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat(k(e.message_type)," bg-current/20"),children:null===(t=e.message_type)||void 0===t?void 0:t.toUpperCase()}),e.is_bot_response&&(0,o.jsx)("span",{className:"px-2 py-1 bg-purple-600 text-white rounded-full text-xs",children:s("messages.bot")})]}),(0,o.jsx)("p",{className:"text-gray-300 text-sm mb-2 line-clamp-2",children:e.content}),(0,o.jsxs)("div",{className:"flex items-center space-x-4 text-xs text-gray-400",children:[(0,o.jsxs)("span",{children:[s("messages.to"),": ",e.recipient_name||e.recipient_id]}),(0,o.jsxs)("span",{className:"flex items-center space-x-1",children:[(0,o.jsx)(x.A,{className:"w-3 h-3"}),w(e.created_at)]})]})]})})},e.id)}),0===g.length&&(0,o.jsx)("p",{className:"text-gray-400 text-center py-8",children:s("messages.no_messages")})]})}),v&&(0,o.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:(0,o.jsxs)(r.A,{className:"w-full max-w-2xl mx-4 max-h-[90vh] overflow-y-auto",children:[(0,o.jsxs)("div",{className:"flex justify-between items-start mb-4",children:[(0,o.jsx)("h2",{className:"text-xl font-bold text-white",children:s("messages.details")}),(0,o.jsx)("button",{onClick:()=>y(null),className:"text-gray-400 hover:text-white",children:(0,o.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,o.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,o.jsxs)("div",{className:"space-y-4",children:[(0,o.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:s("messages.from")}),(0,o.jsx)("p",{className:"text-white",children:v.sender_name||v.sender_id})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:s("messages.to_label")}),(0,o.jsx)("p",{className:"text-white",children:v.recipient_name||v.recipient_id})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:s("messages.type")}),(0,o.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat(k(v.message_type)," bg-current/20"),children:null===(e=v.message_type)||void 0===e?void 0:e.toUpperCase()})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:s("messages.timestamp")}),(0,o.jsx)("p",{className:"text-white",children:w(v.created_at)})]})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:s("messages.content")}),(0,o.jsx)("p",{className:"text-white bg-dark-800/50 p-3 rounded whitespace-pre-wrap",children:v.content})]}),v.metadata&&(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:s("messages.metadata")}),(0,o.jsx)("pre",{className:"text-xs text-gray-400 bg-dark-800/50 p-3 rounded overflow-x-auto",children:JSON.stringify(v.metadata,null,2)})]})]})]})})]})}},5088:(e,s,t)=>{t.d(s,{A:()=>a});const a=(0,t(1639).A)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]])}}]);
//# sourceMappingURL=653.78025c8e.chunk.js.map