/*! For license information please see 970.0f84a68e.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunkmeshtastic_admin_frontend=self.webpackChunkmeshtastic_admin_frontend||[]).push([[970],{970:(e,t,s)=>{s.r(t),s.d(t,{default:()=>p});var a=s(2555),i=s(5043),d=s(4117),r=s(3230),l=s(5592),n=s(1639);const c=(0,n.A)("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);var o=s(7104),x=s(516);const m=(0,n.A)("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),u=(0,n.A)("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]),h=(0,n.A)("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);var g=s(579);const p=()=>{var e;const{t:t}=(0,d.Bd)(),[s,n]=(0,i.useState)([]),[p,j]=(0,i.useState)({}),[y,b]=(0,i.useState)(!0),[v,f]=(0,i.useState)(1),[N,w]=(0,i.useState)(1),[_,k]=(0,i.useState)(!1),[L,A]=(0,i.useState)(null),[C,S]=(0,i.useState)(!1),[U,z]=(0,i.useState)({action:"",resource:"",admin_user_id:"",start_date:"",end_date:""});(0,i.useEffect)(()=>{R(),M()},[v,U]);const R=async()=>{try{const e=new URLSearchParams({limit:50..toString(),offset:(50*(v-1)).toString()});U.action&&e.append("action",U.action),U.resource&&e.append("resource",U.resource),U.admin_user_id&&e.append("admin_user_id",U.admin_user_id),U.start_date&&e.append("start_date",U.start_date),U.end_date&&e.append("end_date",U.end_date);const t=await fetch("/api/audit/?".concat(e)),s=await t.json();n(s.logs||[]),w(Math.ceil((s.total||0)/50))}catch(e){console.error("Error fetching audit logs:",e)}finally{b(!1)}},M=async()=>{try{const e=await fetch("/api/audit/stats/overview"),t=await e.json();j(t)}catch(e){console.error("Error fetching audit stats:",e)}},E=(e,t)=>{z((0,a.A)((0,a.A)({},U),{},{[e]:t})),f(1)},D=e=>new Date(e).toLocaleString(),q=e=>({create:"text-green-400 bg-green-400/10",update:"text-blue-400 bg-blue-400/10",delete:"text-red-400 bg-red-400/10",view:"text-gray-400 bg-gray-400/10",login:"text-purple-400 bg-purple-400/10",logout:"text-orange-400 bg-orange-400/10"}[e]||"text-gray-400 bg-gray-400/10");return y?(0,g.jsx)("div",{className:"flex items-center justify-center min-h-96",children:(0,g.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-accent-cyan"})}):(0,g.jsxs)("div",{className:"space-y-6",children:[(0,g.jsxs)("div",{className:"flex justify-between items-center",children:[(0,g.jsx)("h1",{className:"text-3xl font-bold text-white",children:t("auditLogs.title")}),(0,g.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,g.jsxs)(l.A,{onClick:()=>k(!_),variant:"ghost",size:"sm",children:[(0,g.jsx)(c,{className:"w-4 h-4 mr-2"}),t("auditLogs.filters")]}),(0,g.jsxs)(l.A,{onClick:async()=>{try{const e=new URLSearchParams;U.action&&e.append("action",U.action),U.resource&&e.append("resource",U.resource),U.admin_user_id&&e.append("admin_user_id",U.admin_user_id),U.start_date&&e.append("start_date",U.start_date),U.end_date&&e.append("end_date",U.end_date);const t=await fetch("/api/audit/?".concat(e,"&limit=1000")),s=await t.json(),a=[["Timestamp","User","Action","Resource","Resource ID","Details","IP Address"].join(","),...s.logs.map(e=>[e.timestamp,e.username||"Unknown",e.action,e.resource,e.resource_id||"",'"'.concat((e.details||"").replace(/"/g,'""'),'"'),e.ip_address||""].join(","))].join("\n"),i=new Blob([a],{type:"text/csv"}),d=URL.createObjectURL(i),r=document.createElement("a");r.href=d,r.download="audit-logs-".concat((new Date).toISOString().split("T")[0],".csv"),document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(d)}catch(e){console.error("Error exporting logs:",e)}},variant:"primary",size:"sm",children:[(0,g.jsx)(o.A,{className:"w-4 h-4 mr-2"}),t("auditLogs.export")]}),(0,g.jsx)(l.A,{onClick:R,variant:"ghost",size:"sm",children:(0,g.jsx)(x.A,{className:"w-4 h-4"})})]})]}),(0,g.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,g.jsxs)(r.A,{className:"text-center",children:[(0,g.jsx)("div",{className:"text-2xl font-bold text-white",children:p.total_logs||0}),(0,g.jsx)("div",{className:"text-sm text-gray-400",children:t("auditLogs.total_logs")})]}),(0,g.jsxs)(r.A,{className:"text-center",children:[(0,g.jsx)("div",{className:"text-2xl font-bold text-green-400",children:p.recent_logs||0}),(0,g.jsx)("div",{className:"text-sm text-gray-400",children:t("auditLogs.recent_logs")})]}),(0,g.jsxs)(r.A,{className:"text-center",children:[(0,g.jsx)("div",{className:"text-2xl font-bold text-blue-400",children:(null===(e=p.action_breakdown)||void 0===e?void 0:e.length)||0}),(0,g.jsx)("div",{className:"text-sm text-gray-400",children:t("auditLogs.unique_actions")})]})]}),_&&(0,g.jsx)(r.A,{children:(0,g.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-4",children:[(0,g.jsxs)("div",{children:[(0,g.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:t("auditLogs.action")}),(0,g.jsxs)("select",{value:U.action,onChange:e=>E("action",e.target.value),className:"w-full px-3 py-2 bg-dark-800 border border-dark-600 rounded-lg text-white focus:border-accent-cyan focus:outline-none",children:[(0,g.jsx)("option",{value:"",children:t("auditLogs.all_actions")}),(0,g.jsx)("option",{value:"create",children:t("auditLogs.create")}),(0,g.jsx)("option",{value:"update",children:t("auditLogs.update")}),(0,g.jsx)("option",{value:"delete",children:t("auditLogs.delete")}),(0,g.jsx)("option",{value:"view",children:t("auditLogs.view")}),(0,g.jsx)("option",{value:"login",children:t("auditLogs.login")}),(0,g.jsx)("option",{value:"logout",children:t("auditLogs.logout")})]})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:t("auditLogs.resource")}),(0,g.jsxs)("select",{value:U.resource,onChange:e=>E("resource",e.target.value),className:"w-full px-3 py-2 bg-dark-800 border border-dark-600 rounded-lg text-white focus:border-accent-cyan focus:outline-none",children:[(0,g.jsx)("option",{value:"",children:t("auditLogs.all_resources")}),(0,g.jsx)("option",{value:"user",children:t("auditLogs.user")}),(0,g.jsx)("option",{value:"alert",children:t("auditLogs.alert")}),(0,g.jsx)("option",{value:"zone",children:t("auditLogs.zone")}),(0,g.jsx)("option",{value:"audit_logs",children:t("auditLogs.audit_logs")})]})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:t("auditLogs.start_date")}),(0,g.jsx)("input",{type:"datetime-local",value:U.start_date,onChange:e=>E("start_date",e.target.value),className:"w-full px-3 py-2 bg-dark-800 border border-dark-600 rounded-lg text-white focus:border-accent-cyan focus:outline-none"})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:t("auditLogs.end_date")}),(0,g.jsx)("input",{type:"datetime-local",value:U.end_date,onChange:e=>E("end_date",e.target.value),className:"w-full px-3 py-2 bg-dark-800 border border-dark-600 rounded-lg text-white focus:border-accent-cyan focus:outline-none"})]}),(0,g.jsx)("div",{className:"flex items-end",children:(0,g.jsx)(l.A,{onClick:()=>{z({action:"",resource:"",admin_user_id:"",start_date:"",end_date:""}),f(1)},variant:"secondary",className:"w-full",children:t("auditLogs.clear_filters")})})]})}),(0,g.jsxs)(r.A,{children:[(0,g.jsx)("div",{className:"overflow-x-auto",children:(0,g.jsxs)("table",{className:"w-full",children:[(0,g.jsx)("thead",{children:(0,g.jsxs)("tr",{className:"border-b border-dark-600",children:[(0,g.jsx)("th",{className:"text-left py-3 px-4 text-sm font-medium text-gray-300",children:t("auditLogs.timestamp")}),(0,g.jsx)("th",{className:"text-left py-3 px-4 text-sm font-medium text-gray-300",children:t("auditLogs.user")}),(0,g.jsx)("th",{className:"text-left py-3 px-4 text-sm font-medium text-gray-300",children:t("auditLogs.action")}),(0,g.jsx)("th",{className:"text-left py-3 px-4 text-sm font-medium text-gray-300",children:t("auditLogs.resource")}),(0,g.jsx)("th",{className:"text-left py-3 px-4 text-sm font-medium text-gray-300",children:t("auditLogs.details")}),(0,g.jsx)("th",{className:"text-left py-3 px-4 text-sm font-medium text-gray-300",children:t("auditLogs.actions")})]})}),(0,g.jsx)("tbody",{children:s.map(e=>(0,g.jsxs)("tr",{className:"border-b border-dark-700 hover:bg-dark-800/30",children:[(0,g.jsx)("td",{className:"py-3 px-4 text-sm text-gray-300",children:D(e.timestamp)}),(0,g.jsx)("td",{className:"py-3 px-4 text-sm text-white",children:e.username||"Unknown"}),(0,g.jsx)("td",{className:"py-3 px-4",children:(0,g.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat(q(e.action)),children:e.action.toUpperCase()})}),(0,g.jsxs)("td",{className:"py-3 px-4 text-sm text-gray-300",children:[e.resource,e.resource_id&&(0,g.jsxs)("span",{className:"text-accent-cyan ml-1",children:["#",e.resource_id]})]}),(0,g.jsx)("td",{className:"py-3 px-4 text-sm text-gray-400 max-w-xs truncate",children:e.details}),(0,g.jsx)("td",{className:"py-3 px-4",children:(0,g.jsx)("button",{onClick:()=>{A(e),S(!0)},className:"text-accent-cyan hover:text-accent-cyan/80 text-sm",children:(0,g.jsx)(m,{className:"w-4 h-4"})})})]},e.id))})]})}),0===s.length&&(0,g.jsx)("p",{className:"text-gray-400 text-center py-8",children:t("auditLogs.no_logs")})]}),N>1&&(0,g.jsxs)("div",{className:"flex justify-between items-center",children:[(0,g.jsxs)("div",{className:"text-sm text-gray-400",children:[t("auditLogs.page")," ",v," ",t("auditLogs.of")," ",N]}),(0,g.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,g.jsx)(l.A,{onClick:()=>f(Math.max(1,v-1)),disabled:1===v,variant:"ghost",size:"sm",children:(0,g.jsx)(u,{className:"w-4 h-4"})}),(0,g.jsx)(l.A,{onClick:()=>f(Math.min(N,v+1)),disabled:v===N,variant:"ghost",size:"sm",children:(0,g.jsx)(h,{className:"w-4 h-4"})})]})]}),C&&L&&(0,g.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:(0,g.jsxs)(r.A,{className:"w-full max-w-2xl mx-4 max-h-[90vh] overflow-y-auto",children:[(0,g.jsxs)("div",{className:"flex justify-between items-start mb-4",children:[(0,g.jsx)("h2",{className:"text-xl font-bold text-white",children:t("auditLogs.log_details")}),(0,g.jsx)("button",{onClick:()=>S(!1),className:"text-gray-400 hover:text-white",children:(0,g.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,g.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,g.jsxs)("div",{className:"space-y-4",children:[(0,g.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,g.jsxs)("div",{children:[(0,g.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:t("auditLogs.timestamp")}),(0,g.jsx)("p",{className:"text-white",children:D(L.timestamp)})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:t("auditLogs.user")}),(0,g.jsx)("p",{className:"text-white",children:L.username||"Unknown"})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:t("auditLogs.action")}),(0,g.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat(q(L.action)),children:L.action.toUpperCase()})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:t("auditLogs.resource")}),(0,g.jsxs)("p",{className:"text-white",children:[L.resource,L.resource_id&&(0,g.jsxs)("span",{className:"text-accent-cyan ml-1",children:["#",L.resource_id]})]})]})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:t("auditLogs.details")}),(0,g.jsx)("p",{className:"text-white bg-dark-800/50 p-3 rounded whitespace-pre-wrap",children:L.details})]}),L.ip_address&&(0,g.jsxs)("div",{children:[(0,g.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:t("auditLogs.ip_address")}),(0,g.jsx)("p",{className:"text-white",children:L.ip_address})]})]})]})})]})}},7104:(e,t,s)=>{s.d(t,{A:()=>a});const a=(0,s(1639).A)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]])}}]);
//# sourceMappingURL=970.0f84a68e.chunk.js.map